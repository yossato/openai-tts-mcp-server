# Phase 2 動作確認手順

## 📋 概要

Phase 2で実装された機能の動作確認手順です。音声パラメータ選択機能と音声再生機能をテストします。

## 🛠️ 実装された機能

### 拡張されたツール

#### `generate_speech` (拡張版)
**新パラメータ**:
- `voice`: 音声選択 (alloy, echo, fable, onyx, nova, shimmer, coral)
- `speed`: 再生速度 (0.25-4.0)
- `response_format`: 出力形式 (mp3, opus, aac, flac, wav, pcm)
- `output_mode`: 出力方法 (file, play, both)

#### `list_voices` (新機能)
**機能**: 利用可能な音声一覧と特徴説明を取得

## 🧪 テスト手順

### 前提条件
- Phase 1が正常に動作している
- Claude Desktopが最新のサーバー設定で再起動済み

### テスト 1: 新しいlist_voicesツール

```
音声の種類を教えてください
```

**期待される結果**: 
- 利用可能な音声一覧が表示される
- 各音声の特徴説明が含まれる
- サポートされている出力形式が表示される

### テスト 2: 音声パラメータの選択

#### 2-1: 異なる音声での生成
```
nova音声でこのテキストを音声にしてください: "こんにちは、私はNova音声です"
```

#### 2-2: 速度調整
```
速度1.5倍で音声を生成してください: "これは早口のテストです"
```

#### 2-3: 低速再生
```
速度0.7倍でゆっくり話してください: "ゆっくりと丁寧に話します"
```

### テスト 3: 音声再生機能

#### 3-1: ファイル保存のみ（従来通り）
```
以下のテキストをファイルのみ保存してください: "ファイル保存テスト"
```

#### 3-2: 音声再生のみ
```
以下のテキストを再生してください（ファイルは一時的）: "音声再生テスト"
```

#### 3-3: ファイル保存＋音声再生
```
以下のテキストを保存して再生してください: "保存と再生の両方のテスト"
```

### テスト 4: 出力形式の変更

#### 4-1: WAV形式
```
WAV形式で音声を生成してください: "WAV形式のテスト"
```

#### 4-2: FLAC形式（高品質）
```
FLAC形式で高品質音声を作成してください: "高品質音声のテスト"
```

### テスト 5: 複合パラメータ

#### 5-1: 全パラメータ指定
```
coral音声、速度1.3倍、WAV形式、保存と再生両方で「総合テストです」を音声化してください
```

#### 5-2: 男性音声でフォーマル
```
onyx音声、通常速度、mp3形式で「重要なお知らせがあります」を音声化してください
```

### テスト 6: エラーハンドリング

#### 6-1: 無効な音声名
```
存在しない音声「invalid」で音声を生成してください: "エラーテスト"
```

#### 6-2: 速度範囲外
```
速度5.0で音声を生成してください: "速度エラーテスト"
```

#### 6-3: 空テキスト
```
空のテキストで音声を生成してください: ""
```

## ✅ 成功基準

### Phase 2成功基準
- [ ] **音声選択機能**: 異なる音声（alloy, nova, coral等）で生成できる
- [ ] **速度調整機能**: 0.25-4.0の範囲で速度変更できる
- [ ] **音声再生機能**: 生成した音声がmacOSで再生される
- [ ] **出力モード選択**: file/play/bothの選択ができる
- [ ] **list_voicesツール**: 音声一覧と説明が正しく表示される
- [ ] **エラーハンドリング**: 不正パラメータで適切なエラーメッセージ
- [ ] **出力形式選択**: MP3以外の形式（WAV、FLAC等）で生成できる

### 期待されるレスポンス例

**generate_speech成功例**:
```json
{
  "success": true,
  "file_path": "/tmp/openai_tts_mcp/tts_20250608_150000_123456.mp3",
  "message": "音声ファイルを生成しました: tts_20250608_150000_123456.mp3",
  "parameters": {
    "text_length": 15,
    "voice": "nova",
    "speed": 1.2,
    "response_format": "mp3",
    "output_mode": "both"
  },
  "playback_status": {
    "attempted": true,
    "successful": true
  }
}
```

**list_voices成功例**:
```json
{
  "success": true,
  "voices": {
    "alloy": "中性的で汎用性の高い音声",
    "echo": "男性的で深みのある音声",
    "fable": "女性的で温かみのある音声",
    ...
  },
  "supported_formats": ["mp3", "opus", "aac", "flac", "wav", "pcm"],
  ...
}
```

## 🐛 トラブルシューティング

### 音声再生が失敗する場合
1. macOSでafplayが利用可能か確認
2. 音声出力デバイスが正常に動作しているか確認
3. ログで具体的なエラーメッセージを確認

### パラメータエラーが発生する場合
1. パラメータの型と範囲を確認
2. 列挙値（enum）の正確性を確認
3. 必須パラメータの指定を確認

---

**Phase 2実装日**: 2025年6月8日  
**次回**: Phase 3実装予定
